#!/bin/bash
set -e

# Lancer l'initialisation de la base de données en arrière-plan
echo "Lancement de l'initialisation de la base de données..."
/app/init-db.sh &

# Attendre un peu pour que la DB ait le temps de démarrer si nécessaire
sleep 5

# Convertir le niveau de log en minuscules pour Uvicorn
LOG_LEVEL_LOWER=$(echo "${LOG_LEVEL:-info}" | tr '[:upper:]' '[:lower:]')

# Lancer le serveur Uvicorn avec le point d'entrée corrigé
echo "Démarrage du serveur MCP Crawl4AI RAG avec niveau de log: $LOG_LEVEL_LOWER"
exec uvicorn src.mcp_rest:app --host "0.0.0.0" --port "${PORT:-8010}" --log-level "$LOG_LEVEL_LOWER"
